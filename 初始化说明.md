# LoopWorkspace 项目初始化说明

## 项目概述

这是一个 Loop iOS 应用的工作空间项目。Loop 是一个开源的人工胰腺系统应用。

## 已完成的初始化步骤

✅ **1. Git 子模块初始化**
- 所有子模块已成功初始化和更新

✅ **2. Ruby 环境配置**
- 通过 Homebrew 安装了 Ruby 3.4.7
- Ruby 路径: `/usr/local/opt/ruby/bin`

✅ **3. Bundler 安装**
- 安装了 Bundler 2.6.2（项目所需版本）

✅ **4. Ruby 依赖安装**
- 通过 `bundle install` 安装了 93 个 gem 包
- 包括 fastlane（iOS 自动化工具）及其依赖

## 系统要求

- **操作系统**: macOS（iOS 开发必需）
- **Xcode**: 最新版本
- **Ruby**: >= 3.1.0（已安装 3.4.7）
- **Homebrew**: 包管理器（已安装）

## 后续使用步骤

### 1. 配置 Ruby 环境（重要！）

每次打开新的终端窗口时，需要确保使用 Homebrew 安装的 Ruby：

```bash
# 将以下内容添加到 ~/.zshrc 文件中（如果还没有添加）
echo 'export PATH="/usr/local/opt/ruby/bin:$PATH"' >> ~/.zshrc
source ~/.zshrc
```

### 2. 打开项目

在终端中执行：

```bash
cd /Users/liyang/Documents/work/wunew/ios/loopcloud2/loopcloudtest
xed .
```

或者直接双击 `LoopWorkspace.xcworkspace` 文件。

**注意**: 请打开 `.xcworkspace` 文件，而不是 `.xcodeproj` 文件。

### 3. 配置开发团队（如需真机调试）

如果要在真实 iPhone 设备上运行应用：

1. 在 Xcode 中打开 `LoopConfigOverride.xcconfig` 文件
2. 取消注释 `LOOP_DEVELOPMENT_TEAM` 行
3. 将其值替换为你的 Apple 开发者团队 ID
   - 可以在 https://developer.apple.com/ 查找你的团队 ID

示例：
```
LOOP_DEVELOPMENT_TEAM = ABC1234567
```

### 4. 构建项目

1. 在 Xcode 中选择 **"LoopWorkspace"** scheme（不是 "Loop" scheme）
2. 选择目标设备（模拟器或真机）
3. 点击运行按钮或按 `⌘R`

## 快速初始化脚本

下次需要重新初始化项目时，可以直接运行：

```bash
./init_project.sh
```

这个脚本会自动执行所有初始化步骤。

## 常用命令

### 更新子模块
```bash
git submodule update --init --recursive
```

### 更新 Ruby 依赖
```bash
export PATH="/usr/local/opt/ruby/bin:$PATH"
bundle update
```

### 使用 Fastlane
```bash
export PATH="/usr/local/opt/ruby/bin:$PATH"
bundle exec fastlane [action]
```

## 项目结构

- `Loop/` - 主应用代码
- `LoopKit/` - Loop 核心框架
- `LoopWorkspace.xcworkspace/` - Xcode 工作空间
- `DanaKit/`, `OmniKit/`, `OmniBLE/` - 胰岛素泵集成
- `G7SensorKit/`, `CGMBLEKit/` - CGM 传感器集成
- `fastlane/` - 构建自动化配置
- `Scripts/` - 实用脚本

## 故障排除

### 如果遇到 Ruby 版本问题

确保在执行命令前设置正确的 PATH：

```bash
export PATH="/usr/local/opt/ruby/bin:$PATH"
ruby --version  # 应该显示 3.4.7 或更高版本
```

### 如果遇到 Bundler 版本问题

```bash
gem install bundler:2.6.2
```

### 如果子模块初始化失败

```bash
git submodule sync
git submodule update --init --recursive --force
```

### 如果 Xcode 构建失败

1. 清理构建缓存: `⌘⇧K` 或 Product → Clean Build Folder
2. 关闭并重新打开 Xcode
3. 确保选择的是 "LoopWorkspace" scheme

## 参考文档

- [Loop 官方文档](https://loopkit.github.io/loopdocs/)
- [Mac/Xcode 构建指南](https://loopkit.github.io/loopdocs/build/overview/)
- [GitHub 构建指南](fastlane/testflight.md)

## 注意事项

⚠️ **重要提示**:
- 这是医疗设备软件，请谨慎使用
- 仅用于学习和开发目的
- 实际使用前请充分测试并咨询医疗专业人员

---

**初始化完成时间**: 2025年10月23日  
**Ruby 版本**: 3.4.7  
**Bundler 版本**: 2.6.2  
**安装的 Gem 数量**: 93

